---
title: MongoDb创建，删除，更改
tags: [MongoDb]
categories: 数据库
abbrlink: 9aa16efd
date: 2015-10-18 19:09:28
---
###### 插入并保存文档
>db.foo.insert({'bar':baz"})

会自动给文档增加一个"_id"键(如果原来没有的话)。驱动程序会将数据转换成BSON形式，数据库解析BSON，检验是否包含'_id'键，并且文档长度不能超过4MB
删除文档
>db.users.remove()

会删除users集合中的所有文档，但是不会删除集合本身，原来的索引也会保留。remove函数可以接受一个查询文档作为可选参数，只有符合条件的文档才会被删除，例如 >db.mailing.list.remove({'opt-out':true})
删除集合
>db.users.drop()

会删除users集合，所有的索引也会被删除，速度要比remove()快很多
###### 更新文档
文档存入数据库以后，可以使用update方法来修改他，update有两个参数，一个是查询文档，用来找出要更新的文档，另一个是修改器文档，描述对找到的文档做哪些更改
<!--more-->

* 文档替换
>db.users.update({'name':'nicolas'},{'age':20})

完全用一个文档去替换另一个文档，不使用任何关键字，默认文档会变成和第二个参数文档完全一样的形式，例子中更新之后文档中就只有age字段

* 使用修改器

对字段值修改不需要改变文档的大小，修改速度非常快。对数组修改可能需要改变文档的大小，修改速度回慢一下
`$inc`
>db.users.update({'name':'nicolas'},{$age:{'age',1}})

更新之后age字段会增加1，当为负数时自减。当键不存在时创建一个键。只能用于整数，长整数和说京都浮点数

`$set`
>db.user.update({'name':'nicolas'},{$set:{'age':20}}) 

$set用来指定一个键的值，如果这个键不存在就创建他。$set甚至可以修改键的数据类型。$set可以修改内嵌文档，只要将内嵌字段用"."连接即可，类似于引用对象变量

`$unset·
>db.users.update({'name':'nicolas'},{$unset:{'age':1}})

会将age的键删除

`$push`
如果指定的键已经存在，会向已有的数组末尾加入一个元素，要是没有就会创建一个新的数组



`$ne`
>db.users.update({'course':{$ne:'english'}},{$push:{'course':'english'}})    

当course字段中不存在english值时，会向course字段数组中放入english

`$addToSet`
>db.users.update({'name':'nicolas'},{$addToSet:{'courses':'english'}})

当name为nicolas中的course字段数组中不包括english是向其中添加english

`$each`
>db.users.update({'name':'nicolas'},{$addToSet:{'course':{$each:['english','chinese','math']}}})    

如果不存在这像个课程就像course字段中一次添加这些课程

`$pop`
>db.users.update({'name':'nicolas'},{$pop:{'course':1}})    

可以冲数组的任何一段删除元素，1从数组末尾删除一个元素，-1从数组头部删除

`$pull`
>db.users.update({'name':'nicolas'},{$pull:{'course':'english'}})	

根据特定条件删除元素，例子中删除course数组中值为english的元素

`$`
>db.blog.update({'post':1},{$inc,{'comments.0.votes':1}})

使comments数组下标为0的元素中votes字段的值自增1
>db.blog.update({'comments.author':'nicolas'},{$inc,{'comments.$.votes':1}})

首先会查找comments数组中author为nicolas的元素，记录下其下标。并改变该下标中元素的votes值为1

* upsert

> db.person.update({'name':'windylee'},{$set:{'age':21,'sex':'man'}},true)

upsert是一种特殊的更新，要是没有文档符合更新调价，就会以这个条件和更新文档为基础创建一个新的文档，如果匹配则正常更新。将update的第三个参数设置为true即可开启此功能。例子中将会插入name，age，sex三个字段

- 更新多个文档

默认情况下，更新只能对符合匹配条件的第一个文档执行操作，要使所有匹配到的文档都得到更新，可以设置update的第四个参数为true


