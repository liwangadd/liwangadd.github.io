---
title: MySQL开发规范
tags:
  - Database
  - MySQL
categories: Database
abbrlink: 4827c64b
date: 2018-12-30 22:10:18
---

### 基础规范

- 表存储引擎必须是innoDB
- 表字符集默认使用utf8，必要时使用utf8mb4（utf8mb4是utf8的超集，可以存储4字节如表情符号）
- 禁止使用存储过程，视图，触发器，Event（对数据库性能影响较大，互联网业务，能让站点层和服务层干的事情，不要交到数据库层）
- 禁止在数据库中存储大文件，例如照片（可以将大文件存储在对象存储系统，数据库中存储路径）

### 命名规范

- 库名，表名，列名必须用小写，采用下划线分隔，长度不要超过32个字符
- 库备份必须以bak为前缀，以日期为后缀
- 从库必须以-s为后缀
- 备库必须以-ss为后缀

<!-- more -->

### 表设计规范

- 表必须有主键，推荐使用UNSIGNED整数为主键
- 禁止使用外键，如果要保证完整性，应由应用程序实现（外键使得表之间相互耦合，影响update/delete等SQL性能，有可能造成死锁，高并发情况下容易成为数据库瓶颈）
- 建议讲大字段，访问频度低的字段才分到单独的表中存储，分离冷热数据

### 列设计规范

- 根据业务区分使用tinyint/int/bigint，分别会占用1/4/8字节
- 根据业务区分使用char/varchar（字段长度固定或者长度近似的业务场景，适合使用char，能够减少碎片，查询性能高；字段长度相差较大或者更新较少的业务场景，适合使用varchar，能够减少空间）
- 根据业务区分使用datetime/timestamp（前者占用5个字节，后者占用4个字节，存储年使用YEAR，存储日起使用DATE，存储时间使用datetime）
- 必须把字段定义为NOT NULL并设置默认值（NULL的列使用索引，索引统计都更加复杂，MySQL更难优化；NULL需要更多的存储空间；NULL只能采用IS NULL或者IS NOT NULL）
- 使用INT UNSIGNED存储ipv4，不要使用char(15)
- 使用varchar(20)存储手机号，不要使用整数（牵扯到国家代号，可能出现+/-/()等字符，例如+86；手机号不会用来做数学运算；varchar可以模糊查询）
- 使用TINYINT来代替ENUM（ENUM增加新值都需要进行进行DDL操作）

### 索引规范

- 唯一索引使用uniq\_[字段名]来命名，非唯一索引使用idx\_[字段名]来命名
- 单张表索引数量建议控制到5个以内（太多索引会影响写性能；生成执行计划时，如果索引太多，会降低性能，并可能导致MySQL选择不到最有索引；异常复杂的查询需求，可以选择ES等更为合适的方式存储）
- 组合索引字段数不建议超过5个（如果5个还不能极大缩小row范围，可能是设计问题）
- 不建议在更新频繁的字段上建立索引
- 非必要不要进行JOIN查询，如果要进行JOIN查询，被JOIN的字段必须类型相同，并建立索引
- 理解组合索引最左前缀原则，避免重复建立索引。如果建立了(a, b, c)，相当于建立了(a), (a, b), (a, b, c)

### SQL规范

- 禁止使用select *, 只获取必要字段（select *会增加cpu/io/内存/带宽的消耗; 指定字段能有效利用索引覆盖；指定字段查询，在表结构变更时，能保证对应用程序无影响）
- insert必须指定字段，禁止使用insert into T values()，（指定字段插入，在表结构变更时，能保证对应用程序无影响）
- 禁止在where条件列使用函数或者表达式（导致不能命中索引，全表扫描）
- 禁止大表JOIN和子查询
- 同一个字段上的OR必须改写为IN，IN的值必须少于50个
- 应用程序必须捕获SQL异常